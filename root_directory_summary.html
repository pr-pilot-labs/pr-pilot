<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Overview</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/1.0.2/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <section class="section">
        <div class="container">
            <h1 class="title">Project Overview</h1>
            <p>This project, PR Pilot, is a developer tool/platform that assists developers in their daily work and integrates with the dev tools they use daily. It is built using Django, Python, Docker, and Kubernetes.</p>

            <h2 class="subtitle">Files in the Root Directory</h2>
            <ul>
                <li><strong>README.md:</strong> Provides an overview of the project, installation instructions, usage examples, and contribution guidelines.</li>
                <li><strong>Makefile:</strong> Contains various commands for building, deploying, and managing the project, including Docker image creation and Kubernetes deployment.</li>
                <li><strong>Dockerfile:</strong> Defines the Docker image for the project, including the installation of dependencies and configuration of the application.</li>
                <li><strong>requirements.txt:</strong> Lists the Python dependencies required for the project, including Django, PyGithub, OpenAI, and more.</li>
                <li><strong>version.txt:</strong> Contains the current version of the project, which is 1.9.10.</li>
            </ul>

            <h2 class="subtitle">Interactive Elements</h2>
            <p>Click on the file names below to view their content:</p>
            <ul>
                <li><a href="#readme">README.md</a></li>
                <li><a href="#makefile">Makefile</a></li>
                <li><a href="#dockerfile">Dockerfile</a></li>
                <li><a href="#requirements">requirements.txt</a></li>
                <li><a href="#version">version.txt</a></li>
            </ul>

            <h3 id="readme" class="title is-4">README.md</h3>
            <pre><code># PR Pilot

Save time and stay in the flow by delegating routine work to AI with confidence and predictability. PR Pilot assist you in your daily workflow and works with the dev tools you trust and love - exactly when and where you want it.

Get started now with our [User Guide](https://docs.pr-pilot.ai/user_guide.html).

### Hand of work to PR Pilot from anywhere

You can interact with PR Pilot in a variety of ways:

#### Using the **[Command-Line Interface](https://github.com/PR-Pilot-AI/pr-pilot-cli)**

```bash
pilot edit main.py "Add docstrings to all functions and classes"
```

With [prompt templates](https://github.com/PR-Pilot-AI/pr-pilot-cli/tree/main/prompts), you can create powerful,
reusable commands:

```markdown
I've made some changes and opened a new PR: #{{ env('PR_NUMBER') }}.

I need a PR title and a description that summarizes these changes in short, concise bullet points.
The PR description will also be used as merge commit message, so it should be clear and informative.

Use the following guidelines:

- Start title with a verb in the imperative mood (e.g., "Add", "Fix", "Update").
- At the very top, provide 1-sentence summary of the changes and their impact.
- Below, list the changes made in bullet points.

# Your task
Edit PR #{{ env('PR_NUMBER') }} title and description to reflect the changes made in this PR.
```

Send PR Pilot off to give any PR a title and description according to your guidelines:

```bash
PR_NUMBER=153 pilot task -f generate-pr-description.md.jinja2
```

#### Using the **[Python SDK](https://github.com/PR-Pilot-AI/pr-pilot-python)**:

```python
from pr_pilot.util import create_task, wait_for_result

prompt = """
1. Find all 'bug' issues created yesterday on Slack and Linear.
2. Summarize and post them to #bugs-daily on Slack
3. Save the summary in `reports/<date>.md`
"""

github_repo = "PR-Pilot-AI/pr-pilot"
task = create_task(github_repo, prompt)
result = wait_for_result(task)

print(result)
```

#### Using the **[REST API](https://app.pr-pilot.ai/api/redoc/)**:

```bash 
curl -X POST 'https://app.pr-pilot.ai/api/tasks/' \
-H 'Content-Type: application/json' \
-H 'X-Api-Key: YOUR_API_KEY_HERE' \
-d '{
    "prompt": "Properly format the README.md and add emojis",
    "github_repo": "owner/repo"
}'
```

#### Using **[Smart Workflows](https://github.com/PR-Pilot-AI/smart-workflows)**:

```yaml
# .github/workflows/chat_bot.yaml`

name: "ü§ñ My Project's Custom Chat Bot"

on:
  issues:
    types: [labeled, commented]
  issue_comment:
    types: [created]

jobs:
  handle-chat:
    if: >
      (github.event.label.name == 'chat' || contains(github.event.issue.labels.*.name, 'chat')) &&
      github.event.sender.login != 'pr-pilot-ai[bot]'
    runs-on: ubuntu-latest
    steps:
      - name: AI Chat Response
        uses: PR-Pilot-AI/smart-actions/quick-task@v1
        with:
          api-key: ${{ secrets.PR_PILOT_API_KEY }}
          agent-instructions: |
              @${{ github.event.sender.login }} commented on issue #${{ github.event.issue.number }}.
              Read the content of issue #${{ github.event.issue.number }}.
              If there are no comments yet, add a comment that makes sense in the context of the issue.
              If there are comments, provide a response to the latest comment.
```

#### or talk to PR Pilot directly on **[Github issues and PRs](https://github.com/PR-Pilot-AI/pr-pilot/issues?q=label:demo+)**:

![First pilot command](docs/source/img/first_command.png)

## üõ†Ô∏è Installation

To get started, follow our [User Guide](https://docs.pr-pilot.ai/user_guide.html).

## üöÄ Run Locally

Set the following environment variables:

| Variable                | Description                                                     |
|-------------------------|-----------------------------------------------------------------|
| `GITHUB_APP_CLIENT_ID`  | GitHub App Client ID                                            |
| `GITHUB_APP_SECRET`     | GitHub App Secret                                               |
| `GITHUB_WEBHOOK_SECRET` | Secret for securing webhooks                                    |
| `GITHUB_APP_ID`         | GitHub App ID                                                   |
| `OPENAI_API_KEY`        | API key for OpenAI services                                     |
| `REPO_DIR`              | Directory for storing repository data                           |
| `TAVILY_API_KEY`        | API key for Tavily search engine                                |
| `STRIPE_API_KEY`        | Stripe API key for handling payments                            |
| `STRIPE_WEBHOOK_SECRET` | Secret for securing Stripe webhook endpoints                    |
| `DJANGO_SECRET_KEY`     | Secret key for Django                                           |
| `SENTRY_DSN`            | (Optional) Sentry DSN for error monitoring                      |
| `JOB_STRATEGY`          | (Optional) Strategy for running jobs ('thread', 'redis', 'log') |
| `REDIS_HOST`            | (Optional) Redis host for job scheduling                        |
| `REDIS_PORT`            | (Optional) Redis port for job scheduling                        |
| `REPO_CACHE_DIR`        | (Optional) Directory for storing repository cache               |
| `REPO_DIR`              | (Optional) Workspace for storing repo in worker                 |
| `SLACK_APP_ID`          | Slack App ID               |
| `SLACK_CLIENT_ID`       | Slack Client ID            |
| `SLACK_CLIENT_SECRET`   | Slack Client Secret        |
| `SLACK_SIGNING_SECRET`  | Slack Signing Secret       |

To get PR Pilot up and running on your own machine, follow these steps:


```bash
# Clone the repository
git clone https://github.com/PR-Pilot-AI/pr-pilot.git

# Change directory
cd pr-pilot

# Install dependencies
pip install -r requirements.txt

# Apply migrations
python manage.py migrate

# Create a superuser
python manage.py createsuperuser

# Start the development server
python manage.py runserver
```

To expose your local server to the internet, you can use `ngrok`:

```bash
ngrok http 8000
```

## üß™ Unit Tests

PR Pilot uses `tox` for managing unit tests. The test setup is configured in the `tox.ini` file, and tests are written using `pytest`.

To run the tests, execute:

```bash
tox
```

This will run all the tests defined in the project, ensuring that your changes do not break existing functionality.

## üìö Code Documentation

For more information on the code structure and documentation, please visit [docs/code](docs/code).

## ü§ù Contributing

We welcome contributions to PR Pilot! Please check out our [contributing guidelines](CONTRIBUTING.md) for more information on how to get involved.

## üìÑ License

PR Pilot is open source and available under the GPL-3 License. See the [LICENSE](LICENSE) file for more info.
</code></pre>

            <h3 id="makefile" class="title is-4">Makefile</h3>
            <pre><code># Variables
VERSION := $(shell cat version.txt)
APP_IMAGE_NAME := pr-pilot-app
WORKER_IMAGE_NAME := pr-pilot-worker
NGINX_IMAGE_NAME := pr-pilot-static
REGISTRY_URL := us-west2-docker.pkg.dev/darwin-407004/pr-pilot

# Phony Targets
.PHONY: logs build-static build-docker docker-push deploy create-k8s-secrets makemigrations

# Logs
logs:
    stern -l app=pr-pilot | grep -v "/health"

# Build Targets
build-static:
    python manage.py collectstatic --no-input

build-docker: build-static
    docker build --platform linux/amd64 -t $(APP_IMAGE_NAME):$(VERSION) .
    docker build --platform linux/amd64 -t $(WORKER_IMAGE_NAME):$(VERSION) -f Dockerfile.worker .
    docker build --platform linux/amd64 -t $(NGINX_IMAGE_NAME):$(VERSION) -f nginx/Dockerfile nginx

# Docker Push
# Push Docker images to the registry
# Tags images with both version and latest
# Pushes both tags to the registry
docker-push: build-docker
    docker tag $(APP_IMAGE_NAME):$(VERSION) $(REGISTRY_URL)/$(APP_IMAGE_NAME):$(VERSION)
    docker tag $(APP_IMAGE_NAME):$(VERSION) $(REGISTRY_URL)/$(APP_IMAGE_NAME):latest
    docker push $(REGISTRY_URL)/$(APP_IMAGE_NAME):$(VERSION)
    docker push $(REGISTRY_URL)/$(APP_IMAGE_NAME):latest
    docker tag $(WORKER_IMAGE_NAME):$(VERSION) $(REGISTRY_URL)/$(WORKER_IMAGE_NAME):$(VERSION)
    docker tag $(WORKER_IMAGE_NAME):$(VERSION) $(REGISTRY_URL)/$(WORKER_IMAGE_NAME):latest
    docker push $(REGISTRY_URL)/$(WORKER_IMAGE_NAME):$(VERSION)
    docker push $(REGISTRY_URL)/$(WORKER_IMAGE_NAME):latest
    docker tag $(NGINX_IMAGE_NAME):$(VERSION) $(REGISTRY_URL)/$(NGINX_IMAGE_NAME):$(VERSION)
    docker tag $(NGINX_IMAGE_NAME):$(VERSION) $(REGISTRY_URL)/$(NGINX_IMAGE_NAME):latest
    docker push $(REGISTRY_URL)/$(NGINX_IMAGE_NAME):$(VERSION)
    docker push $(REGISTRY_URL)/$(NGINX_IMAGE_NAME):latest

# Deploy
# Deploys the application using Helm
# Upgrades or installs the Helm chart with the specified version
deploy:
    helm upgrade --install pr-pilot ./helm-chart --set image.tag=$(VERSION)

# Create Private Key Secret
# Creates a Kubernetes secret for the private key
create-private-key-secret:
    kubectl create secret generic pr-pilot-private-key --from-file=github_app_private_key.pem

# Kubernetes Secrets
# Deletes and recreates Kubernetes secrets from the k8s.env file
create-k8s-secrets:
    kubectl delete secret pr-pilot-secret
    kubectl create secret generic pr-pilot-secret --from-env-file=k8s.env

# Make Migrations
# Runs Django makemigrations command with environment variables from local.env
makemigrations:
    env $(cat local.env | xargs) python manage.py makemigrations

# Ngrok
# Starts ngrok with a specified domain
ngrok:
    ngrok http --domain=helping-willing-seasnail.ngrok-free.app 8000

# PR Description
# Generates title and PR description (requires PR_NUMBER env var to be set)
pr-description:
    pilot --no-spinner task -f prompts/generate_pr_description.md.jinja2

# Daily Report
# Generates daily report
# Uses a specific prompt file for the task
daily-report:
    pilot task -f prompts/slack-report.md.jinja2

redis-docker:
    docker run -d -p 6379:6379 redis

# Run an iripgrep search in the docker container on a known file
rg-test:
    docker run -v $(PWD):/app -it --rm --entrypoint /bin/bash $(WORKER_IMAGE_NAME):$(VERSION) -c "rg 'class Experiment' --glob '**/*.py' /app"
</code></pre>

            <h3 id="dockerfile" class="title is-4">Dockerfile</h3>
            <pre><code>FROM --platform=linux/amd64 python:3.11-slim

# Set environment variables
ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1

# Install system dependencies required for uWSGI compilation
RUN apt-get update && apt-get install -y \
    gcc \
    libc6-dev \
    libpcre3-dev \
    && rm -rf /var/lib/apt/lists/*

RUN apt-get update && \
    apt-get install -y --only-upgrade openssl && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Set work directory
WORKDIR /usr/src/app

# Install uwsgi
RUN pip install uwsgi

# Install dependencies
COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

# Copy project
COPY . .

# uwsgi.ini configuration
COPY uwsgi.ini /usr/src/app/uwsgi.ini

# Expose port 8000 for uwsgi
EXPOSE 8000

# Run uwsgi
CMD ["uvicorn", "--host", "0.0.0.0", "--port", "8000", "prpilot.asgi:application"]
</code></pre>

            <h3 id="requirements" class="title is-4">requirements.txt</h3>
            <pre><code>django==5.0.3
django-allauth==0.61.1
PyGithub==2.2.0
langchain_openai==0.1.7
langchain==0.2.7
langchain-community==0.2.7
langchainhub==0.1.14
openai==1.24.0
GitPython==3.1.42
instructor==0.3.5
beautifulsoup4==4.12.3
html2text
kubernetes==29.0.0
jinja2==3.1.3
psycopg2-binary==2.9.9
django-tables2==2.7.0
Markdown==3.5.2
sentry-sdk==1.41.0
stripe==8.7.0
djangorestframework==3.15.2
djangorestframework-api-key==3.*
drf_spectacular==0.27.2
django-cors-headers==4.3.1
redis==5.0.4
black
flake8
slack_sdk==3.27.2
channels==4.1.0
channels-redis==4.2.0
uvicorn==0.30.3
websockets==12.0
</code></pre>

            <h3 id="version" class="title is-4">version.txt</h3>
            <pre><code>1.9.10</code></pre>
        </div>
    </section>
</body>
</html>